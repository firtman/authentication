{"pageProps":{"post":{"attributes":{},"html":"<h1 id=\"adding-endpoints\">Adding endpoints</h1>\n<p>In <code>server.js</code> let&#39;s add the endpoint</p>\n<pre><code class=\"hljs language-js\">app.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">&quot;/auth/login-google&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res</span>) =&gt;</span> {\n    <span class=\"hljs-keyword\">let</span> jwt = jwtJsDecode.<span class=\"hljs-title function_\">jwtDecode</span>(req.<span class=\"hljs-property\">body</span>.<span class=\"hljs-property\">credential</span>);\n    <span class=\"hljs-keyword\">let</span> payload = jwt.<span class=\"hljs-property\">payload</span>;\n    <span class=\"hljs-keyword\">let</span> user = {\n        <span class=\"hljs-attr\">email</span>: payload.<span class=\"hljs-property\">email</span>,\n        <span class=\"hljs-attr\">name</span>: payload.<span class=\"hljs-property\">given_name</span> + <span class=\"hljs-string\">&quot; &quot;</span> + payload.<span class=\"hljs-property\">family_name</span>,\n        <span class=\"hljs-attr\">password</span>: <span class=\"hljs-literal\">false</span>        \n    }\n    <span class=\"hljs-keyword\">const</span> userFound = <span class=\"hljs-title function_\">findUser</span>(req.<span class=\"hljs-property\">body</span>.<span class=\"hljs-property\">email</span>);\n\n    <span class=\"hljs-keyword\">if</span> (userFound) {\n        <span class=\"hljs-comment\">// User exists, we update it with the Google data</span>\n        user.<span class=\"hljs-property\">google</span> = payload.<span class=\"hljs-property\">aud</span>;\n        db.<span class=\"hljs-title function_\">write</span>();\n        res.<span class=\"hljs-title function_\">send</span>({<span class=\"hljs-attr\">ok</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-attr\">name</span>: user.<span class=\"hljs-property\">name</span>, <span class=\"hljs-attr\">email</span>: userFound.<span class=\"hljs-property\">email</span>});    \n    } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-comment\">// User doesn&#x27;t exist we create it </span>\n        db.<span class=\"hljs-property\">data</span>.<span class=\"hljs-property\">users</span>.<span class=\"hljs-title function_\">push</span>({\n            ...user,\n            <span class=\"hljs-attr\">federated</span>: {\n                <span class=\"hljs-attr\">google</span>: payload.<span class=\"hljs-property\">aud</span>,\n            }\n        });\n        db.<span class=\"hljs-title function_\">write</span>();\n        res.<span class=\"hljs-title function_\">send</span>({<span class=\"hljs-attr\">ok</span>: <span class=\"hljs-literal\">true</span>, <span class=\"hljs-attr\">name</span>: user.<span class=\"hljs-property\">name</span>, <span class=\"hljs-attr\">email</span>: user.<span class=\"hljs-property\">email</span>});\n\n    }\n});\n</code></pre>\n<p>And within <code>API.js</code>:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-attr\">loginFromGoogle</span>: <span class=\"hljs-keyword\">async</span> (data) =&gt; {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-variable constant_\">API</span>.<span class=\"hljs-title function_\">makePostRequest</span>(<span class=\"hljs-variable constant_\">API</span>.<span class=\"hljs-property\">endpoint</span> + <span class=\"hljs-string\">&quot;login-google&quot;</span>, data);\n},\n</code></pre>\n","slug":"adding-endpoint","title":"Adding Endpoint","section":"Sign in with Google","icon":"lock-open","filePath":"/Users/firt/Library/Mobile Documents/com~apple~CloudDocs/Trainings/FEM/Authentication/fullstack-authentication/lessons/04-sign-in-with-google/C-adding-endpoint.md","nextSlug":"/authentication/lessons/using-webauthn/changing-flow-to-identifier-first","prevSlug":"/authentication/lessons/sign-in-with-google/creating-code"}},"__N_SSG":true}